<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juguete ‚Äì MejoresJuguetes.com</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/estilos.css">
  <meta name="description" content="Ficha completa del juguete con valoraci√≥n, descripci√≥n y enlaces a Amazon y AliExpress.">
</head>

<body>

<header class="header">
  <div class="container header-flex">

    <div class="logo-box">
      <img src="img/hero.png" alt="Logo MejoresJuguetes" class="logo-img">
      <span class="logo-text">MejoresJuguetes.com</span>
    </div>

    <nav class="menu">
      <a href="index.html">Inicio</a>
      <a href="blog.html">Blog</a>
      <a href="juguetes.html" class="active">Juguetes</a>
      <a href="rankings.html">Rankings</a>
      <a href="resenas.html">Rese√±as</a>
      <a href="contacto.html">Contacto</a>
    </nav>

    <div class="search-box">
      <form action="buscar.html" method="GET">
        <input type="text" name="q" placeholder="Buscar juguetes..." required>
        <button type="submit">üîç</button>
      </form>
    </div>

  </div>
</header>

<section class="hero" style="background-image: url('img/hero.png');">
  <div class="container" style="background: rgba(0,0,0,0.55); padding: 50px 30px; border-radius: 12px;">
    <h2 id="tituloHero" style="color: #fff; font-size: 2.2rem;">Cargando...</h2>
    <p id="breadcrumb" style="color:#ddd; margin-top:8px; font-size:0.95rem;"></p>
  </div>
</section>

<main class="container">
  <section class="section" id="contenidoJuguete">
    <p>Cargando datos...</p>
  </section>
</main>

<footer class="footer">
  <div class="container">
    <p>¬© 2025 MejoresJuguetes.com ‚Äì Todos los derechos reservados</p>
    <div class="footer-links">
      <a href="privacidad.html">Pol√≠tica de privacidad</a>
      <a href="cookies.html">Pol√≠tica de cookies</a>
      <a href="aviso-legal.html">Aviso legal</a>
    </div>
  </div>
</footer>

<script>
  const DEFAULT_IMG = "img/default-toy.png";
  const AFFILIATE_TAG = "librarium01-21";

  function generarEstrellas(rating) {
    const r = Number(rating) || 0;
    const estrellas = Math.round(r);
    return "‚≠ê".repeat(Math.max(0, Math.min(5, estrellas))) + ` (${r}/5)`;
  }

  function normalizarCategoria(cat) {
    if (!cat) return "Otros";
    const mapa = {
      "montessori": "Montessori",
      "marvel": "Marvel",
      "munecas": "Mu√±ecas",
      "puzzles": "Puzzles"
    };
    return mapa[cat] || cat;
  }

  function construirImagen(j) {
    if (j.imagenAmazon && j.imagenAmazon.trim() !== "") {
      return j.imagenAmazon.trim();
    }
    return DEFAULT_IMG;
  }

  function construirEnlaceAmazon(j, asin) {
    if (j.amazon && j.amazon.trim() !== "") {
      if (j.amazon.includes("tag=")) return j.amazon;
      const sep = j.amazon.includes("?") ? "&" : "?";
      return j.amazon + sep + "tag=" + AFFILIATE_TAG;
    }
    return "https://www.amazon.es/s?k=" + encodeURIComponent(j.titulo || asin) + "&tag=" + AFFILIATE_TAG;
  }

  function construirEnlaceAliExpress(j) {
    if (j.aliexpress && j.aliexpress.trim() !== "") {
      return j.aliexpress;
    }
    return "https://s.click.aliexpress.com/e/_master_link";
  }

  async function cargarJuguete() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    if (!id) {
      document.getElementById("contenidoJuguete").innerHTML = "<p>Error: juguete no especificado.</p>";
      return;
    }

    try {
      const res = await fetch("juguetes.json?_=" + Date.now());
      const data = await res.json();

      const j = data[id];
      if (!j) {
        document.getElementById("contenidoJuguete").innerHTML = "<p>Error: juguete no encontrado.</p>";
        return;
      }

      const titulo = j.titulo || "Juguete sin t√≠tulo";
      const categoria = normalizarCategoria(j.categoria);
      const edad = j.edad || "";
      const marca = j.marca || "";
      const rating = j.rating || 4.5;
      const descripcion = j.descripcion || "Sin descripci√≥n disponible.";

      const imgSrc = construirImagen(j);
      const enlaceAmazon = construirEnlaceAmazon(j, id);
      const enlaceAliExpress = construirEnlaceAliExpress(j);

      document.getElementById("tituloHero").textContent = titulo;
      document.getElementById("breadcrumb").textContent =
        "Inicio ‚Ä∫ Juguetes ‚Ä∫ " + categoria + (edad ? " ‚Ä∫ " + edad : "");

      document.getElementById("contenidoJuguete").innerHTML = `
        <div class="card" style="max-width: 900px; margin: auto; display:flex; flex-wrap: wrap; gap:20px; align-items:flex-start;">
          <div style="flex:0 0 260px; width:100%;">
            <img id="imgJuguete" src="${imgSrc}" alt="${titulo}" style="width:100%; border-radius:6px; object-fit:cover;">
          </div>
          <div style="flex:1; min-width: 280px;">
            <h3 style="margin-top:0;">${titulo}</h3>
            <p><strong>${marca}</strong>${edad ? " ¬∑ " + edad : ""}</p>
            <p>${generarEstrellas(rating)}</p>

            <div style="margin:15px 0; display:flex; flex-wrap:wrap; gap:10px;">
              <a href="${enlaceAmazon}" target="_blank" rel="noopener noreferrer"
                 style="display:inline-block; padding:12px 20px; background:#ff9900; color:#111; border-radius:6px; text-decoration:none; font-weight:bold; border: 1px solid #e47911;">
                üõí Ver en Amazon
              </a>

              <a href="${enlaceAliExpress}" target="_blank" rel="noopener noreferrer"
                 style="display:inline-block; padding:12px 20px; background:#ff2e63; color:#fff; border-radius:6px; text-decoration:none; font-weight:bold;">
                üõí Ver en AliExpress
              </a>
            </div>

            <p style="margin-top:10px; line-height: 1.6;">${descripcion}</p>
          </div>
        </div>
      `;

      const img = document.getElementById("imgJuguete");
      img.addEventListener("error", () => {
        img.src = DEFAULT_IMG;
      });

    } catch (e) {
      console.error("Error cargando juguete:", e);
      document.getElementById("contenidoJuguete").innerHTML = "<p>Error al cargar los datos del juguete.</p>";
    }
  }

  cargarJuguete();
</script>

</body>
</html>
