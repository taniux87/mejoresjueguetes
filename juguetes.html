<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cat√°logo de Juguetes ‚Äì MejoresJuguetes.com</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/estilos.css">
  
  <style>
    /* ‚úÖ ESTILOS PARA LAS PESTA√ëAS */
    .tabs, .subtabs {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .tab-btn, .subtab-btn {
      padding: 10px 18px;
      background: #0A3D62;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      border: 1px solid #082f4a;
      transition: 0.2s ease;
      font-weight: 600;
    }

    .tab-btn.active, .subtab-btn.active {
      background: #C9A86A;
      color: #111;
      border-color: #b8955c;
    }

    /* ‚úÖ GRID DE JUGUETES (CARGA MASIVA) */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    /* ‚úÖ ESTILO DE LA TARJETA (Igual a Rankings) */
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      border: 1px solid #e5e5e5;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: 0.2s ease;
      text-align: center;
      display: block;
      text-decoration: none;
      color: inherit;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .card img {
      width: 100%;
      height: 200px;
      object-fit: contain;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    /* ‚úÖ PAGINACI√ìN */
    .pagination {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 12px;
      align-items: center;
      padding-bottom: 40px;
    }

    .pagination button {
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      background: #0A3D62;
      color: #fff;
      cursor: pointer;
      font-weight: 600;
    }

    .pagination button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>

<body>

<header class="header">
  <div class="container header-flex">
    <div class="logo-box">
      <img src="img/hero.png" alt="Logo MejoresJuguetes" class="logo-img">
      <span class="logo-text">MejoresJuguetes.com</span>
    </div>

    <nav class="menu">
      <a href="index.html">Inicio</a>
      <a href="blog.html">Blog</a>
      <a href="juguetes.html" class="active">Juguetes</a>
      <a href="rankings.html">Rankings</a>
      <a href="resenas.html">Rese√±as</a>
      <a href="contacto.html">Contacto</a>
    </nav>

    <div class="search-box">
      <form action="buscar.html" method="GET">
        <input type="text" name="q" placeholder="Buscar juguetes..." required>
        <button type="submit">üîç</button>
      </form>
    </div>
  </div>
</header>

<section class="hero" style="background-image: url('img/hero.png');">
  <div class="container hero-overlay">
    <h2>Cat√°logo de Juguetes</h2>
    <p>Explora m√°s de 40 opciones por categor√≠a con los mejores precios.</p>
  </div>
</section>

<main class="container">

  <section class="section" style="margin-top: 20px;">
    <div class="tabs" role="tablist">
      <button class="tab-btn active" data-main="montessori">Montessori</button>
      <button class="tab-btn" data-main="munecas">Mu√±ecas</button>
      <button class="tab-btn" data-main="puzzles">Puzzles</button>
      <button class="tab-btn" data-main="general">General</button>
      <button class="tab-btn" data-main="monsterflex">Monsterflex</button>
    </div>
  </section>

  <section class="section">
    <div id="subtabs" class="subtabs"></div>
  </section>

  <section class="section">
    <div id="resultados" class="grid">
      </div>

    <div id="paginacion" class="pagination">
      <button id="btnAnterior" disabled>‚Üê Anterior</button>
      <span id="infoPagina"></span>
      <button id="btnSiguiente" disabled>Siguiente ‚Üí</button>
    </div>
  </section>

</main>

<footer class="footer">
  <div class="container">
    <p>¬© 2025 MejoresJuguetes.com ‚Äì Todos los derechos reservados</p>
    <div class="footer-links">
      <a href="quienes-somos.html">Qui√©nes somos</a>
      <a href="privacidad.html">Pol√≠tica de privacidad</a>
      <a href="cookies.html">Pol√≠tica de cookies</a>
      <a href="aviso-legal.html">Aviso legal</a>
    </div>
  </div>
</footer>

<script>
  // --- CONFIGURACI√ìN Y VARIABLES ---
  let juguetesData = {};
  const AFFILIATE_TAG = "mejoresjuguetes-21";
  const MAX_RESULTS = 40; // CARGA MASIVA SOLICITADA
  const FOTO_DEFECTO = "img/hero.png"; // IMAGEN SI FALLA AMAZON
  
  let paginaActual = 0;
  let categoriaActual = "montessori";
  let subcategoriaActual = "";
  let SUBTABS = {};

  // --- CARGA DE DATOS ---
  async function iniciarCat√°logo() {
    try {
      const respuesta = await fetch("juguetes.json");
      if (!respuesta.ok) throw new Error("No se pudo cargar el JSON");
      juguetesData = await respuesta.json();
      
      generarEstructuraSubtabs();
      categoriaActual = Object.keys(SUBTABS)[0] || "montessori";
      
      cargarBotonesSubtabs();
      mostrarJuguetes();
    } catch (error) {
      console.error("Error:", error);
      document.getElementById("resultados").innerHTML = "<h3>Error al cargar los juguetes.</h3>";
    }
  }

  // --- L√ìGICA DE SUBTABS ---
  function generarEstructuraSubtabs() {
    SUBTABS = {};
    for (const cat in juguetesData) {
      SUBTABS[cat] = {};
      for (const subId in juguetesData[cat]) {
        SUBTABS[cat][subId] = juguetesData[cat][subId].titulo || subId;
      }
    }
  }

  function cargarBotonesSubtabs() {
    const contenedor = document.getElementById("subtabs");
    contenedor.innerHTML = "";
    
    const subcategorias = SUBTABS[categoriaActual];
    if (!subcategorias) return;

    const ids = Object.keys(subcategorias);
    ids.forEach((id, index) => {
      const boton = document.createElement("button");
      boton.className = `subtab-btn ${index === 0 ? "active" : ""}`;
      boton.textContent = subcategorias[id];
      boton.onclick = () => {
        document.querySelectorAll(".subtab-btn").forEach(b => b.classList.remove("active"));
        boton.classList.add("active");
        subcategoriaActual = id;
        paginaActual = 0;
        mostrarJuguetes();
      };
      contenedor.appendChild(boton);
    });
    subcategoriaActual = ids[0];
  }

  // --- L√ìGICA DE RATING ---
  function obtenerEstrellas(rating) {
    const num = Math.min(5, Number(rating) || 0);
    return "‚≠ê".repeat(Math.round(num)) + ` (${num}/5)`;
  }

  // --- RENDERIZADO DE TARJETAS ---
  function crearTarjeta(item, idSub) {
    // Si el item es un objeto que contiene una lista 'items', la procesamos. 
    // Si es un juguete individual, lo procesamos directamente.
    const titulo = item.titulo || "Juguete";
    const img = item.imagenAmazon || FOTO_DEFECTO;
    const rating = item.rating || "4.5";

    return `
      <a href="juguete.html?cat=${categoriaActual}&id=${idSub}" class="card">
        <img src="${img}" onerror="this.src='${FOTO_DEFECTO}'" alt="${titulo}">
        <h3>${titulo}</h3>
        <p>${obtenerEstrellas(rating)}</p>
      </a>
    `;
  }

  async function mostrarJuguetes() {
    const contenedor = document.getElementById("resultados");
    contenedor.innerHTML = "";
    
    const catData = juguetesData[categoriaActual];
    if (!catData || !catData[subcategoriaActual]) return;

    const subData = catData[subcategoriaActual];
    
    // Manejo de si tienes una lista de items dentro de la subcategor√≠a o solo uno
    let todosLosItems = [];
    if (subData.items && Array.isArray(subData.items)) {
      todosLosItems = subData.items;
    } else {
      todosLosItems = [subData];
    }

    const inicio = paginaActual * MAX_RESULTS;
    const fin = inicio + MAX_RESULTS;
    const segmentado = todosLosItems.slice(inicio, fin);

    contenedor.innerHTML = segmentado.map(item => crearTarjeta(item, subcategoriaActual)).join("");

    // Paginaci√≥n
    const totalPaginas = Math.ceil(todosLosItems.length / MAX_RESULTS) || 1;
    document.getElementById("infoPagina").textContent = `P√°gina ${paginaActual + 1} de ${totalPaginas}`;
    document.getElementById("btnAnterior").disabled = paginaActual === 0;
    document.getElementById("btnSiguiente").disabled = paginaActual >= totalPaginas - 1;
    document.getElementById("paginacion").style.display = todosLosItems.length > MAX_RESULTS ? "flex" : "none";
  }

  // --- EVENTOS DE CATEGOR√çA ---
  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      categoriaActual = btn.dataset.main;
      paginaActual = 0;
      cargarBotonesSubtabs();
      mostrarJuguetes();
    });
  });

  document.getElementById("btnAnterior").onclick = () => { if(paginaActual > 0) { paginaActual--; mostrarJuguetes(); }};
  document.getElementById("btnSiguiente").onclick = () => { paginaActual++; mostrarJuguetes(); };

  // --- INICIO ---
  iniciarCat√°logo();
</script>

</body>
</html>

